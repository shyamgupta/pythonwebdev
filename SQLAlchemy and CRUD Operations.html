
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-idle-fingers .ace_gutter {background: #3b3b3b;color: rgb(153,153,153)}.ace-idle-fingers .ace_print-margin {width: 1px;background: #3b3b3b}.ace-idle-fingers {background-color: #323232;color: #FFFFFF}.ace-idle-fingers .ace_cursor {color: #91FF00}.ace-idle-fingers .ace_marker-layer .ace_selection {background: rgba(90, 100, 126, 0.88)}.ace-idle-fingers.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #323232;}.ace-idle-fingers .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-idle-fingers .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #404040}.ace-idle-fingers .ace_marker-layer .ace_active-line {background: #353637}.ace-idle-fingers .ace_gutter-active-line {background-color: #353637}.ace-idle-fingers .ace_marker-layer .ace_selected-word {border: 1px solid rgba(90, 100, 126, 0.88)}.ace-idle-fingers .ace_invisible {color: #404040}.ace-idle-fingers .ace_keyword,.ace-idle-fingers .ace_meta {color: #CC7833}.ace-idle-fingers .ace_constant,.ace-idle-fingers .ace_constant.ace_character,.ace-idle-fingers .ace_constant.ace_character.ace_escape,.ace-idle-fingers .ace_constant.ace_other,.ace-idle-fingers .ace_support.ace_constant {color: #6C99BB}.ace-idle-fingers .ace_invalid {color: #FFFFFF;background-color: #FF0000}.ace-idle-fingers .ace_fold {background-color: #CC7833;border-color: #FFFFFF}.ace-idle-fingers .ace_support.ace_function {color: #B83426}.ace-idle-fingers .ace_variable.ace_parameter {font-style: italic}.ace-idle-fingers .ace_string {color: #A5C261}.ace-idle-fingers .ace_string.ace_regexp {color: #CCCC33}.ace-idle-fingers .ace_comment {font-style: italic;color: #BC9458}.ace-idle-fingers .ace_meta.ace_tag {color: #FFE5BB}.ace-idle-fingers .ace_entity.ace_name {color: #FFC66D}.ace-idle-fingers .ace_collab.ace_user1 {color: #323232;background-color: #FFF980}.ace-idle-fingers .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWMwMjLyZYiPj/8PAAreAwAI1+g0AAAAAElFTkSuQmCC) right repeat-y}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    <title>SQLAlchemy</title>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='Flask Fundamentals.html'>Flask Fundamentals</a>, Up: <a href='index.html'>Home</a></div></div>
      <div id="titlearea">
        <h2>SQLAlchemy and CRUD Operations</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><h1>2.0 ORM Fundamentals</h1></div><div class="cell text-cell"><div><div>ORM stands for Object Relational Mapper. Mappers are responsible for moving data between objects and a database while keeping them independent of each other. As object-oriented programming languages and relational databases structure data on different ways, we need specific code to translate from one schema to the other.&nbsp;</div><div>For example, in a programming language like Python, we can create a Product class and an Order class to relate as many instances as needed from one class to another. Though, on relational databases, we need three entities (tables), one to persist products, another one to persist orders, and a third one to relate (through foreign key) products and orders.&nbsp;</div><div><br></div><div>SQLAlchemy ORM is an excellent Data Mapper solution to translate Python classes into/from tables and to move data between instances of these classes and rows of these tables. Basically:</div></div><div><br></div><div><div><ul><li>Python Class == SQL Table<br></li><li>Instance of the Class == Row in the Table<br></li></ul></div></div><div><br></div>With SQLAlchemy, we can write a single Python file to setup and configure a database. We can call this file db_setup.py. Creating a database with SQLAlchemy has 4 major components:<div><ul><li>Configuration: This is used to import all the necessary modules.</li><li>Class: Used to represent the database table as Python classes. Inside the class declaration we will have the Table and Mapper code.</li><li>Table: Represents the specific table in our database.</li><li>Mapper: Connects the columns of our table to the Python objects that represent it.</li></ul><div>In the below example, we are creating a restaurant database which has 2 tables: below is the schema:</div></div><div><br></div><div><img src="resources/174E4F4D84EA0DFE9CF0AC3305FCFB9A.jpg" width="588" height="272"><br></div></div><div class="cell text-cell"><h2>2.1 SQLEngine</h2></div><div class="cell text-cell">We connect to a database by creating a&nbsp;<b>SQLEngine</b>&nbsp;object, which knows how to talk to one particular type of database (SQLite, PostgreSQL, Firebird, MySQL, Oracle...). The SQLEngine object also doubles as a connection object. Behind the scenes, it will create a pool of database connections and re-use them automatically as needed, to keep your application running quickly. The call to create_engine doesn't actually connect to the database right away, it just prepares for when it does need to connect (for example, creating a table or making a query):</div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span> <span class="ace_keyword">import</span> <span class="ace_identifier">create_engine</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">engine</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">create_engine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'sqlite:///dbname.db'</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell"><h2>2.2 Declarative</h2></div><div class="cell text-cell"><div>When using the ORM, the configurational process starts by:&nbsp;</div><div><ol><li>Describing the database tables we’ll be dealing with,&nbsp;<br></li><li>After that we define our own classes which will be mapped to those tables.&nbsp;</li></ol></div><div>In SQLAlchemy, these two tasks are usually performed together, using a system known as <b>Declarative</b>, which allows us to create classes that include directives to describe the actual database table they will be mapped to, i.e. instead of having to write code for Table, mapper and the class object at different places, SQLAlchemy's declarative allows a table, a mapper and a class object to be defined at once in one class definition.</div><div><br></div><div>Classes mapped using the Declarative system are defined in terms of a base class which maintains a catalog of classes and tables relative to that base - this is known as the declarative base class. Our application will usually have just one instance of this base in a commonly imported module. We create the base class using the <code>declarative_base()</code> function, as shown below. The <code>declarative_base()</code> callable returns a new Base class from which all mapped classes should inherit. Now that we have a “base”, we can define any number of mapped classes in terms of it.</div></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span>.<span class="ace_identifier">ext</span>.<span class="ace_identifier">declarative</span> <span class="ace_keyword">import</span> <span class="ace_identifier">declarative_base</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Base</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">declarative_base</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell">In the below code snippet, we are creating the Restaurant and MenuItem classes:</div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">Restaurant</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Base</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">__tablename__</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'restaurant'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">#Below is our mapper code</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">80</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">nullable</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function">id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>, <span class="ace_identifier">primary_key</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">MenuItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Base</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">__tablename__</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'menu_item'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">#Below is our mapper code</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">80</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">nullable</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function">id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>, <span class="ace_identifier">primary_key</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">course</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">250</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">description</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">250</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">price</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">restaurant_id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>,<span class="ace_identifier">ForeignKey</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'restaurant.id'</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">restaurant</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">relationship</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Restaurant</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell"><div>A class using Declarative at a minimum needs a <code>__tablename__</code> attribute, and at least one Column which is part of a primary key.</div><div>In the Restaurant class:</div><div><ul><li>The <code>__tablename__</code> property tells SQLAlchemy that rows of the <code>restaurant</code> table must be mapped to the <code>Restaurant</code> class.<br></li><li>The <code>id</code> property identifies that this is the primary_key in the table and that its type is Integer<br></li></ul></div><div>The name property indicates that its a string (upto 80 characters long) and cannot be a null value.</div><div>Note: The Column objects are automatically named with the name of the attribute to which they are assigned. To name columns explicitly with a name distinct from their mapped attribute, just give the column a name. Below, column “some_table_id” is mapped to the “id” attribute of SomeClass, but in SQL will be represented as “some_table_id”:</div></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">SomeClass</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Base</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span> <span class="ace_identifier">__table__name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'some_table</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span> <span class="ace_support ace_function">id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"some_table_id"</span>, <span class="ace_identifier">Integer</span>, <span class="ace_identifier">primary_key</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell">The &nbsp;MenuItem class, introduces the ForeignKey construct, which is a directive applied to Column that indicates that values in this column should be constrained to be values present in the named remote column.<div>A second directive, known as relationship(), tells the ORM that MenuItem should be linked to the Restaurant class using the attribute MenuItem.restaurant. The relationship() directive uses the foreign key relationships between the two tables to determine the nature of this linkage, determining that &nbsp;MenuItem.restaurant will be many to one.</div><div><br></div><div>With our Restaurant and MenuItem classes constructed via the Declarative system, we have defined information about our table, known as table metadata. The object used by SQLAlchemy to represent this information for a specific table is called the Table object, and here Declarative has made one for us. In the Python REPL, you can view this metadata using Restaurant.__table__ &nbsp;for example.</div><div>Below code block is the complete database setup file, which when executed creates an empty database with the tables we have specified.</div></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#db_setup.py file</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">import</span> <span class="ace_identifier">sys</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span> <span class="ace_keyword">import</span> <span class="ace_identifier">Column</span>, <span class="ace_identifier">ForeignKey</span>, <span class="ace_identifier">Integer</span>, <span class="ace_identifier">String</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span>.<span class="ace_identifier">ext</span>.<span class="ace_identifier">declarative</span> <span class="ace_keyword">import</span> <span class="ace_identifier">declarative_base</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span>.<span class="ace_identifier">orm</span> <span class="ace_keyword">import</span> <span class="ace_identifier">relationship</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span> <span class="ace_keyword">import</span> <span class="ace_identifier">create_engine</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#declarative_base() callable returns a new base class from which all mapped classes should inherit. </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Base</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">declarative_base</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Class Code</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#We create 2 classes for the 2 tables in our db - they inherit from the Base class</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Inside each class code, we will have the code to represent our table</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">Restaurant</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Base</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">__tablename__</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'restaurant'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">#Below is our mapper code</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">80</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">nullable</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function">id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>, <span class="ace_identifier">primary_key</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">class</span> <span class="ace_identifier">MenuItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Base</span><span class="ace_paren ace_rparen">)</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">__tablename__</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">'menu_item'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">#Below is our mapper code</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">80</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">nullable</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">False</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function">id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>, <span class="ace_identifier">primary_key</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">course</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">250</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">description</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">250</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">price</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">String</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">restaurant_id</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Column</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Integer</span>,<span class="ace_identifier">ForeignKey</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'restaurant.id'</span><span class="ace_paren ace_rparen">))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">restaurant</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">relationship</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Restaurant</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">##Insert below at the end of the file where db_name is the name of the database you'll create</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">engine</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">create_engine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'sqlite:///restaurant_menu.db'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">Base</span>.<span class="ace_identifier">metadata</span>.<span class="ace_identifier">create_all</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">engine</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell">Once we execute the above file, we will have a restaurant_menu.db file created, which is our empty database. In the next sections, we will see how to start populating it.</div><div class="cell text-cell"><h2>2.3 Sessions</h2></div><div class="cell text-cell"><div>The ORM’s “handle” to the database is the Session. Sessions, on SQLAlchemy ORM, are the implementation of the Unit of Work design pattern. A Unit of Work is used to maintain a list of objects affected by a business transaction and to coordinate the writing out of these changes. This means that all modifications tracked by Sessions (Units of Works) will be applied to the underlying database together, or none of them will. In other words, Sessions are used to guarantee the database consistency. Below is the code to create a session in SQLAlchemy:</div></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sqlalchemy</span>.<span class="ace_identifier">orm</span> <span class="ace_keyword">import</span> <span class="ace_identifier">sessionmaker</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># create a configured "Session" class</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">DBSession</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">sessionmaker</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">bind</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">engine</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># create a Session</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">dbsession</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">DBSession</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell text-cell">A DBSession() instance establishes all conversations with the database and represents a "staging zone" for all the objects loaded into the database session object. Any change made against the objects in the session won't be persisted into the database until you call session.commit().</div><div class="cell text-cell"><h1>3.1 Create</h1></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">from</span> <span class="ace_identifier">sqlalchemy</span> <span class="ace_identifier">import</span> <span class="ace_identifier">create_engine</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">from</span> <span class="ace_identifier">sqlalchemy</span>.<span class="ace_identifier">orm</span> <span class="ace_identifier">import</span> <span class="ace_identifier">sessionmaker</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">from</span> <span class="ace_identifier">db_setup</span> <span class="ace_identifier">import</span> <span class="ace_identifier">Base</span>, <span class="ace_identifier">Restaurant</span>, <span class="ace_identifier">MenuItem</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">engine</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">create_engine</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">'</span><span class="ace_string">sqlite:///restaurant_menu.db</span><span class="ace_string ace_end">'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">Base</span>.<span class="ace_identifier">metadata</span>.<span class="ace_support ace_function ace_builtin">bind</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">engine</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">DBSession</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">sessionmaker</span><span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function ace_builtin">bind</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">engine</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_support ace_function">DBSession()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">myFirstRestaurant</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">Restaurant</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">"Happy Platter"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">add</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">myFirstRestaurant</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_support ace_function">commit()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">query</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Restaurant</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_support ace_function">all()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_lparen">[</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_identifier">db_setup</span>.<span class="ace_identifier">Restaurant</span> <span class="ace_identifier">object</span> <span class="ace_identifier">at</span> <span class="ace_constant ace_numeric">0</span><span class="ace_identifier">x8fd740c</span><span class="ace_keyword ace_operator">&gt;</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span><span class="ace_identifier">cheesepizza</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">MenuItem</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">"Cheese Pizza"</span>, <span class="ace_identifier">description</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">"Made with fresh ingredients"</span>, <span class="ace_variable">course=</span><span class="ace_string">"Entree"</span>, <span class="ace_variable">price=</span><span class="ace_string">"</span><span class="ace_variable">$8</span><span class="ace_string">.99"</span>,<span class="ace_variable">restaurant=</span><span class="ace_identifier">myFirstRestaurant</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span><span class="ace_identifier">session</span>.<span class="ace_identifier">add</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cheesepizza</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_support ace_function">commit()</span>
</div></div></div></div><div class="cell text-cell"><h1>3.2 Read</h1></div><div class="cell text-cell">Querying is done using the .query() method : <code>session.query(ClassName).filter_by(attribute = value)</code>. We can then use .one(), .first(), .all() to return exactly one, first result or all results as shown below. Once we get the query result, we can use the dot notation to access the attributes, as shown in line 4.</div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Read first entry - this variable now corresponds to a single row in our db</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">firstResult</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">query</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Restaurant</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_support ace_function">first()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># We can use this variable to extract column entries as method names</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">firstResult</span>.<span class="ace_identifier">name</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">u</span> <span class="ace_string ace_start">'</span><span class="ace_string">Happy Platter</span><span class="ace_string ace_end">'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> 
</div></div></div></div><div class="cell text-cell">We can create a variable and store the results of `session.query(Restaurant).all()` - we can then use a for loop to iterate through the values.</div><div class="cell text-cell"><h1>3.3 Update</h1></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 1- Find the entry you want to update &amp; store it in a variable. filter_by() returns a collection of objects.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">veggieBurgers</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">query</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">MenuItem</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">filter_by</span><span class="ace_paren ace_lparen">(</span><span class="ace_variable">name=</span><span class="ace_string ace_start">'</span><span class="ace_string">Veggie Burger</span><span class="ace_string ace_end">'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">UrbanVeggieBurger</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">query</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">MenuItem</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">filter_by</span><span class="ace_paren ace_lparen">(</span><span class="ace_variable">id=</span><span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_support ace_function">one()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 2 - Declare the new value of the variable</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">UrbanVeggieBurger</span>.<span class="ace_identifier">price</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">'</span><span class="ace_string">$2.99</span><span class="ace_string ace_end">'</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 3 - Add to the session</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">session</span>.<span class="ace_identifier">add</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">UrbanVeggieBurger</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 4 - Commit the session to the database</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">session</span>.<span class="ace_support ace_function">commit()</span>
</div></div></div></div><div class="cell text-cell"><h1>3.4 Delete</h1></div><div class="cell code-cell"><div class="ace-idle-fingers"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 1 - Find the entry to delete &amp; store it in a variable</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">spinach</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">query</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">MenuItem</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">filter_by</span><span class="ace_paren ace_lparen">(</span><span class="ace_variable">name=</span><span class="ace_string ace_start">'</span><span class="ace_string">Spinach Ice Cream</span><span class="ace_string ace_end">'</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_support ace_function">one()</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 2 - Execute a session.delete() on the variable</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_identifier">delete</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">spinach</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#Step 3 - Commit the session to the database</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">&gt;&gt;&gt;&gt;</span> <span class="ace_identifier">session</span>.<span class="ace_support ace_function">commit()</span>
</div></div></div></div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = 'Flask Fundamentals.html';
}</script>
    </body>
    </html>
  